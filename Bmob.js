!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Bmob=e()}(this,function(){"use strict";function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=c(t);if(e){var r=c(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return s(this,n)}}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(t){return(c=Object.getPrototypeOf||function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=e(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";i(this,t),f(this,"errMsg",e)});var h=function(){function t(){i(this,t)}return e(t,[{key:"on",value:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)}},{key:"off",value:function(t,e){this._events=this._events||{},!1!==t in this._events&&this._events[t].splice(this._events[t].indexOf(e),1)}},{key:"emit",value:function(t){for(var e=this,n=this,i=arguments.length,r=new Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];this._events=this._events||{},this._events[t]&&this._events[t].forEach(function(t){"function"==typeof t&&Reflect.apply(t,e,r)}),n._events.all&&n._events.all.forEach(function(t){"function"==typeof t&&Reflect.apply(t,e,[t].concat(r))})}}]),t}();var p=e(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i(this,t),f(this,"url",void 0),f(this,"method",void 0),f(this,"data",void 0),f(this,"header",void 0),f(this,"appSign",void 0),f(this,"Timestamp",void 0),f(this,"safe",!0),this.url=n,this.method=e}),d=function(){function t(){i(this,t)}return e(t,null,[{key:"request",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(n,i){var r;t instanceof p||(t=new p(t,e)),r=Bmob.User.current()?Bmob.User.current().sessionToken:null;var o={};r&&(o["X-Bmob-Session-Token"]=r),o["X-Bmob-Application-Id"]=Bmob.applicationId,o["X-Bmob-REST-API-Key"]=Bmob.restKey,o["Content-Type"]="application/json",Object.assign(o,t.header);var a=t.url.split("://")[0];if(Bmob.Debug&&console.log("请求地址：",t.url),Bmob.Debug&&console.log("请求参数：",t.data),"https"==a||"http"==a){var s;if("undefined"!=typeof uni)s=uni.request;else if("undefined"!=typeof wx)s=wx.request;else if("undefined"!=typeof my)s=my.request;else if("undefined"!=typeof swan)s=swan.request;else if("undefined"!=typeof tt)s=tt.request;else if("undefined"!=typeof window){var u=function(t,e){var n=t.url,i=t.method,r=t.data;e=e||{};var o=new XMLHttpRequest;o.withCredentials=e.withCredentials||!1,o.open(i,n,!0);for(var a in t.header)o.setRequestHeader(a,t.header[a]);return o.onreadystatechange=function(){var t,n,i;4||o.readyState,o.status,t=o.responseText;try{n=JSON.parse(t)}catch(t){n=t}i=o.getAllResponseHeaders().toLowerCase().split("\r\n").reduce(function(t,e){var n=e.split(": ");return t[n[0]]=n[1],t},{})||{},e.success({data:n,statusCode:o.status,header:i})},o.onerror=function(t){e.fail(t)},o.send(r),o};u.abort=function(){},s=u}var c={url:t.url,data:t.data,header:o,method:t.method,success:function(t){if(Bmob.Debug&&console.log("返回结果：",t.data),t.statusCode>=200&&t.statusCode<300||304==t.statusCode)n(t.data);else if(t.data.code)i(t.data);else{var e=JSON.stringify(t.data);i({code:t.statusCode,error:e})}},fail:function(t){i(t)}};s(c)}else{var f;if("undefined"!=typeof uni)f=uni.uploadFile;else if("undefined"!=typeof wx)f=wx.uploadFile;else if("undefined"!=typeof my)f=my.uploadFile;else if("undefined"!=typeof swan)f=swan.uploadFile;else if("undefined"!=typeof tt)f=tt.uploadFile;else if("undefined"!=typeof window){var l=function(t,e){var n=t.url,i=t.header,r=t.formData,o=t.filePath,a=t.name,s=new FormData;for(var u in r)s.append(u,r[u]);var c=new XMLHttpRequest;c.open("post",n,!0);for(var f in i)c.setRequestHeader(f,i[f]);c.onreadystatechange=function(){var t,n;4||c.readyState,c.status,n=c.responseText;try{t=JSON.parse(n)}catch(e){t=n,console.log("JSON parse failed, a string is returned ",t)}e.success({data:t,statusCode:c.status})},c.upload.addEventListener("progress",function(t){var n={progress:t.lengthComputable?t.loaded/t.total*100:0};e.onProgressUpdate(n)}),c.onerror=function(t){e.fail(t)};var l=o.split("."),h=l[l.length-1],p=o.split("/"),d=p[p.length-1];fetch(o).then(function(t){return t.blob()}).then(function(t){s.append(a,t,d),c.send(s)})};l.onProgressUpdate=function(t){"function"==typeof t&&t()},f=l}var h={url:t.url,filePath:t.data.path,name:t.data.name,header:o,formData:t.data.body,success:function(t){var e=t.data;Bmob.Debug&&console.log("返回结果：",e),"string"==typeof e?n(JSON.parse(e)):n(e)},fail:function(t){i(t)}};f(h).onProgressUpdate(function(e){"function"==typeof t.onProgressUpdate&&t.onProgressUpdate(e)})}})})}}]),t}();f(d," emitter",new h);var m,g,v=function t(){i(this,t)},y="https://api2.bmob.cn/1/",b=e(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";i(this,t),f(this,"_path",e),f(this,"_where",[]),f(this,"_include",[]),f(this,"_select",[]),f(this,"_limit",-1),f(this,"_skip",0),f(this,"_order",[]),f(this,"_lookup",[]),f(this,"_group",[]),f(this,"_having",[]),f(this,"data",[]),f(this,"_count",0),f(this,"_object",null)}),_={EQUAL_TO:"$eq",NOT_EQUAL_TO:"$ne",LESS_THAN:"$lt",LESS_THAN_OR_EQUAL_TO:"$lte",GREATER_THAN:"$gt",GREATER_THAN_OR_EQUAL_TO:"$gte",CONTAINED_IN:"$in",NOT_CONTAINED_IN:"$nin",EXISTS:"$exists",DOES_NOT_EXIST:"$nexists",OBJECT_ID:"$inQuery",TEXT:"$text",MATCH:"$regex",OPTIONS:"$options",SELECT:"$select",DONTSELECT:"$dontSelect",ALL:"$all",RELATEDTO:"$relatedTo",OR:"$or",AND:"$and",NOR:"$nor",POINTER:"Pointer",GEOPOINT:"GeoPoint",File:"File",Relation:"Relation"},w=function(){function t(e){i(this,t),f(this,"linked",void 0),this.linked=e}return e(t,[{key:"_encode",value:function(){if(this.linked instanceof D)return{__type:_.POINTER,className:this.linked.className,objectId:this.linked.objectId};throw new Error("类型错误")}}]),t}(),k=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";i(this,t),f(this,"longitude",void 0),f(this,"latitude",void 0),this.longitude=e,this.latitude=n}return e(t,[{key:"_encode",value:function(){return{__type:_.GEOPOINT,longitude:this.longitude,latitude:this.latitude}}},{key:"milesTo",value:function(t){return this.radiansTo(t)/3958.8}},{key:"radiansTo",value:function(t){var e=Math.PI/180,n=this.latitude*e,i=t.latitude*e,r=n-i,o=this.longitude*e-t.longitude*e,a=Math.sin(r/2)*Math.sin(r/2)+Math.cos(n)*Math.cos(i)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}},{key:"kilometersTo",value:function(t){return 1.609344*this.milesTo(t)}}]),t}(),S=function(){function t(e,n){i(this,t),f(this,"parent",void 0),f(this,"key",void 0),this.parent=e,this.key=n}return e(t,[{key:"add",value:function(t){var e,n=this.parent.get(this.key);return e=n||[],e.push(t),this.parent.set(this.key,e),this.parent.save()}},{key:"remove",value:function(t){var e=this.parent.get(this.key);e&&e.splice(e.indexOf(t),1),this.parent.set(this.key,e),this.parent.save()}},{key:"query",value:function(){var t=new x(this.parent.className);return t.equalTo(this.key,this.parent.objectId),t}}]),t}(),x=function(t){r(s,t);var n=a(s);function s(t){var e;return i(this,s),(e=n.call(this,t))._path="/classes/"+t,e}return e(s,[{key:"_request",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",n={},i=this._where;if(i.length>0&&(t=JSON.stringify(i),n.where=t),this._include.length>0&&(n.include=this._include.join(",")),this._select.length>0&&(n.keys=this._select.join(",")),-1!=this._limit&&(n.limit=this._limit),this._skip>0&&(n.skip=this._skip),this._order.length>0&&(n.order=this._order.join(",")),this._count>0&&(n.count=this._count),this._lookup)for(var r in this._lookup)n[r]=JSON.stringify(this._lookup[r]);var o=y+"classes/"+this._object.className,a={};if(this._object.objectId&&(o+="/"+this._object.objectId),this._object.data){var s={};for(var u in a=this._object.data,a){var c,f=a[u];if(f instanceof w)c=f._encode();else if(f instanceof k)c=f._encode();else if(f instanceof S)c={__op:"AddRelation",objects:[f.parent._encode()]};else if(f instanceof Array&&f[0]instanceof D)c={__op:"AddUnique",objects:f};else if(f instanceof D)c=f._encode();else{if(!(f instanceof Object&&Reflect.has(f,"__op")))continue;if("Increment"==f.__op){var l={};f.amount=f.amount||1,s[u]=f}else if("Add"==f.__op){var h={};s[u]=f}else if("AddUnique"==f.__op){var p={};s[u]=f}else if("Remove"==f.__op){var d={};s[u]=f}else if("Delete"==f.__op){var m={};s[u]=f}c=s[u]}s[u]&&(a[u]=c)}a=Object.assign(a,s)}var g=new URL(o),v=g.search;n&&Object.keys(n).forEach(function(t){v?v+="&":v="?",v+=t+"="+n[t]}),g.search=v;var b=new p(e,g.href);return"POST"!=e&&"PUT"!=e||(b.data=a),d.request(b)}},{key:"_handle",value:function(t){var e=this;if(t instanceof Array)return t.map(function(t){var n=new D(e._object.className);return n.set(t),n});var n=new D(this._object.className);return n.set(t),n}},{key:"equalTo",value:function(t,e){var n;n={},this._where.push(function(e){var i;return f(i={},t,n[t]=e),i}(e)),this.data.push(this._where[this._where.length-1])}},{key:"notEqualTo",value:function(t,e){var n={};n[t]={$ne:e},this._where.push(n)}},{key:"lessThan",value:function(t,e){var n={};n[t]={$lt:e},this._where.push(n)}},{key:"lessThanOrEqualTo",value:function(t,e){var n={};n[t]={$lte:e},this._where.push(n)}},{key:"greaterThan",value:function(t,e){var n={};n[t]={$gt:e},this._where.push(n)}},{key:"greaterThanOrEqualTo",value:function(t,e){var n={};n[t]={$gte:e},this._where.push(n)}},{key:"containedIn",value:function(t,e){var n={};n[t]={$in:e},this._where.push(n)}},{key:"notContainedIn",value:function(t,e){var n={};n[t]={$nin:e},this._where.push(n)}},{key:"exists",value:function(t){var e={};e[t]={$exists:!0},this._where.push(e)}},{key:"doesNotExist",value:function(t){var e={};e[t]={$exists:!1},this._where.push(e)}},{key:"select",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._select=e}},{key:"skip",value:function(t){this._skip=t}},{key:"limit",value:function(t){this._limit=t}},{key:"ascending",value:function(t){this._order.push(t)}},{key:"descending",value:function(t){this._order.push("-"+t)}},{key:"include",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._include=e}},{key:"count",value:function(){return this._count=1,this._limit=0,this._request().then(function(t){var e=t.count,n=t.results;return Promise.resolve(e||n.length)})}},{key:"find",value:function(t){return this._request(t).then(function(t){var e=t.results;return Promise.resolve(e)})}},{key:"get",value:function(t){var e=this;this.equalTo("objectId",t);var n=y+"classes/"+this.className+"/"+t;return this._request("GET",n).then(function(t){return e._handle(t)})}},{key:"first",value:function(){var t=this;return this._limit=1,this.find().then(function(e){return e&&e.length?t._handle(e[0]):Promise.resolve()})}},{key:"destroy",value:function(t){return this._request("DELETE",t).then(function(t){return Promise.resolve(t)})}},{key:"save",value:function(){return this.objectId?this._request("PUT"):this._request("POST")}},{key:"saveAll",value:function(t){var e=this.className,n=t.map(function(t){var n={method:"POST",path:"/1/classes/"+e,body:t.data};return t.objectId&&(n.method="PUT",n.path+="/"+t.objectId),n});return d.request({method:"POST",url:y+"batch",data:{requests:n}})}},{key:"destroyAll",value:function(t){var e=this;if(0==t.length)return Promise.resolve();if(t instanceof D){var n=new b(this.className);return n.destroy(t.objectId)}if(t instanceof Array){var i=t.map(function(t){return e.destroy(t.objectId)}),r=d.request({method:"POST",url:y+"batch",data:{requests:i}});return Promise.all(r)}}},{key:"or",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i={};i.$or=e.map(function(t){return t.data[0]}),this._where.push(i)}},{key:"relatedTo",value:function(t,e){var n={};n.object={__type:"Pointer",className:t,objectId:e},n.key=t,this._where.push({$relatedTo:n})}},{key:"File",value:function(){}},{key:"pipeline",value:function(t){return this.lookup(t),this}},{key:"lookup",value:function(t){this._lookup=Object.assign(this._lookup,t)}},{key:"group",value:function(t){this._lookup.group=t}},{key:"match",value:function(t){this._lookup.match=t}},{key:"project",value:function(t){this._lookup.project=t}},{key:"unwind",value:function(t){this._lookup.unwind=t}}]),s}(b),D=function(t){r(s,t);var n=a(s);function s(t){var e,r;return i(this,s),f(u(r=n.call(this,t)),"className",void 0),f(u(r),"_serverData",{}),(e=new x(t))._object=u(r),r.className=t,Object.assign(r,e),r}return e(s,[{key:"set",value:function(t,e){return this.data=Object.assign(this.data,t),this}},{key:"get",value:function(t){return this.data[t]}},{key:"toPointer",value:function(){return new w(this)}},{key:"relation",value:function(t){return new S(this,t)}},{key:"increment",value:function(t,e){return this.set(t,{__op:"Increment",amount:e||1})}},{key:"add",value:function(t,e){return this.set(t,{__op:"Add",objects:e})}},{key:"addUnique",value:function(t,e){return this.set(t,{__op:"AddUnique",objects:e})}},{key:"remove",value:function(t,e){return this.set(t,{__op:"Remove",objects:e})}},{key:"subtract",value:function(t,e){return this.set(t,{__op:"Increment",amount:-e||-1})}},{key:"unset",value:function(t){var e={};return e[t]={__op:"Delete"},this.set(e,null)}},{key:"_encode",value:function(){return{__type:_.POINTER,className:this.className,objectId:this.objectId}}}]),s}(D=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";i(this,t),f(this,"data",{}),this.set(e)}return e(t,[{key:"set",value:function(t,e){return this.data=Object.assign(this.data,t),this}}]),t}());"undefined"!=typeof navigator&&navigator.product,m="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},g={};var P=Object.freeze({__proto__:null,get:function(){return m},set:function(t,e){return g[t]=e,m[t]=e}});var T=function(){function t(){i(this,t)}return e(t,[{key:"get",value:function(t){return new Promise(function(e,n){var i;if("undefined"!=typeof uni)i=uni.getStorage;else if("undefined"!=typeof wx)i=wx.getStorage;else if("undefined"!=typeof my)i=my.getStorage;else if("undefined"!=typeof swan)i=swan.getStorage;else if("undefined"!=typeof tt)i=tt.getStorage;else if("undefined"!=typeof localStorage)return e(localStorage.getItem(t));i({key:t,success:function(t){e(t.data)},fail:function(t){e(null)}})})}},{key:"set",value:function(t,e){return new Promise(function(n,i){var r;if("undefined"!=typeof uni)r=uni.setStorage;else if("undefined"!=typeof wx)r=wx.setStorage;else if("undefined"!=typeof my)r=my.setStorage;else if("undefined"!=typeof swan)r=swan.setStorage;else if("undefined"!=typeof tt)r=tt.setStorage;else if("undefined"!=typeof localStorage)return localStorage.setItem(t,e),n();r({key:t,data:e,success:function(t){n()},fail:function(t){i()}})})}},{key:"remove",value:function(t){return new Promise(function(e,n){var i;if("undefined"!=typeof uni)i=uni.removeStorage;else if("undefined"!=typeof wx)i=wx.removeStorage;else if("undefined"!=typeof my)i=my.removeStorage;else if("undefined"!=typeof swan)i=swan.removeStorage;else if("undefined"!=typeof tt)i=tt.removeStorage;else if("undefined"!=typeof localStorage)return localStorage.removeItem(t),e();i({key:t,success:function(t){e()},fail:function(t){n()}})})}}]),t}(),E=function(t){r(o,t);var n=a(o);function o(){var t;return i(this,o),f(u(t=n.call(this,"_User")),"authData",{}),t}return e(o,[{key:"linkWith",value:function(){}},{key:"signUp",value:function(){var t,e=this;return this.username=this.get("username"),this.password=this.get("password"),this.email=this.get("email"),this.mobilePhoneNumber=this.get("mobilePhoneNumber"),t=this.username?"/users":"/usersByMobilePhone",this.save(t).then(function(t){return e.set(t),e._saveCurrentUser(e),Promise.resolve(e)})}},{key:"login",value:function(t,e){var n,i=this;return n={username:t,password:e},d.request({url:y+"login",data:n}).then(function(t){return i.set(t),i._saveCurrentUser(i),Promise.resolve(i)})}},{key:"loginWithSms",value:function(t,e){var n,i=this;return n={mobilePhoneNumber:t,smsCode:e},d.request({method:"POST",url:y+"users",data:n}).then(function(t){return i.set(t),i._saveCurrentUser(i),Promise.resolve(i)})}},{key:"loginWithWeapp",value:function(t){var e,n=this;return e={authData:{"we-app":t}},d.request({method:"POST",url:y+"users",data:e}).then(function(t){return n.set(t),n._saveCurrentUser(n),Promise.resolve(n)})}},{key:"requestEmailVerify",value:function(t){return d.request({method:"POST",url:y+"requestEmailVerify",data:{email:t}})}},{key:"requestPasswordReset",value:function(t){return d.request({method:"POST",url:y+"requestPasswordReset",data:{email:t}})}},{key:"updatePassword",value:function(t,e,n){return d.request({method:"PUT",url:y+"updatePassword",header:{"X-Bmob-Session-Token":n},data:{oldPassword:t,newPassword:e}})}},{key:"_saveCurrentUser",value:function(t){var e=new T;e.set("bmobUser",JSON.stringify(t.data))}},{key:"_currentUser",value:function(){var t=this,e=new T;return e.get("bmobUser").then(function(e){return e?Promise.resolve(t.set(JSON.parse(e))):Promise.resolve(null)})}},{key:"isAuthenticated",value:function(){return this.getSessionToken()}},{key:"getSessionToken",value:function(){return this.get("sessionToken")}}],[{key:"logOut",value:function(){var t=new T;return t.remove("bmobUser").then(function(t){return o.emitter.emit("logout"),Promise.resolve()})}},{key:"current",value:function(){var t=P.get("BmobCurrentUser");if(t)return t;var e=new o;return t=e._currentUser().then(function(e){return P.set("BmobCurrentUser",e),Promise.resolve(e)})}},{key:"requestSmsCode",value:function(t){return d.request({method:"POST",url:y+"requestSmsCode",data:{mobilePhoneNumber:t}})}},{key:"verifySmsCode",value:function(t,e){return d.request({method:"POST",url:y+"verifySmsCode/"+t,data:{mobilePhoneNumber:e}})}}]),o}(D);f(E,"emitter",new h);var C=e(function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t),f(this,"_name",void 0),f(this,"_meta",void 0),f(this,"_url",void 0),f(this,"_body",void 0),f(this,"_path",void 0),this._name=e,this._meta=n}),O=function(){function t(){i(this,t)}return e(t,null,[{key:"upload",value:function(t,e){var i,r="string"==typeof(i=e.data)?i:i.path,o=r.split("."),a=o[o.length-1],s=y+"files/"+t+"."+a;return d.request({method:"POST",url:s,data:e.data}).then(function(t){return Object.assign({name:t.filename,url:t.url,path:r}),Promise.resolve(t)})}}]),t}(),j={};return j.version="2.5.10",j.ABI={version:"2.5.10"},j.serverURL=y,j.h=h,j.Socket=function(t){var e,n,r=this,o=0;this.liveQuery=new h,this.init=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(i=Object.assign(i,Bmob),e=i.applicationId,n=i.applicationKey,t){var a;if("undefined"!=typeof uni)a=uni.connectSocket;else if("undefined"!=typeof wx)a=wx.connectSocket;else if("undefined"!=typeof my)a=my.connectSocket;else if("undefined"!=typeof swan)a=swan.connectSocket;else if("undefined"!=typeof tt)a=tt.connectSocket;else if(window){var s=function(t){return t.onOpen=function(e){t.open&&t.open(e),r.heartbeat()},t.onMessage=function(t){t.message&&t.message(t)},t.onError=function(e){t.error&&t.error(e),r.reconnect()},t.onClose=function(e){t.close&&t.close(e),r.reconnect()},new WebSocket(t.url)},u=function(){};s.onOpen=u,s.onMessage=u,s.onError=u,s.onClose=u,a=s}a({url:t,success:function(t){console.log("connectSocket success",t)},fail:function(t){console.log("connectSocket fail",t)}}).onOpen(function(t){console.log("WebSocket连接已打开！"),r.login()}),a.onMessage(function(t){r.message(t)}),a.onError(function(t){console.log("WebSocket连接打开失败，请检查！")}),a.onClose(function(t){console.log("WebSocket 已关闭！")})}else console.error("缺少`Bmob.initialize`")},this.login=function(){var t,i=JSON.stringify({op:"login",appId:e,apiKey:n});if(t=a.send)t({data:i,success:function(t){console.log("send success",t)},fail:function(t){console.log("send fail",t)},complete:function(t){console.log("send complete",t)}});else{var o;if("undefined"!=typeof uni)o=uni.sendSocketMessage;else if("undefined"!=typeof wx)o=wx.sendSocketMessage;else if("undefined"!=typeof my)o=my.sendSocketMessage;else if("undefined"!=typeof swan)o=swan.sendSocketMessage;else if("undefined"!=typeof tt)o=tt.sendSocketMessage;else if(window)o=function(t){a.send(t.data)};o({data:i})}},this.message=function(t){var e=JSON.parse(t.data);e.result,r.liveQuery.emit(e.op,e)},this.heartbeat=function(){o=setInterval(function(){r.send('{"op":"heartbeat"}')},6e4)},this.reconnect=function(){r.close(),setTimeout(function(){r.init(i)},3e3)},this.send=function(t){a.send({data:t})},this.close=function(){clearInterval(o),a.close({code:1e3,reason:"正常关闭",success:function(){},fail:function(){}})},this.init()},j.Pay=function(){function t(){i(this,t)}return e(t,null,[{key:"wechat",value:function(t,e,n){return d.request(y+"pay/"+t,{data:{"return_url":e,openid:n}})}},{key:"alipay",value:function(t,e,n){return d.request(y+"pay/"+t,{data:{"return_url":e,method:n}})}},{key:"orderQuery",value:function(t){return d.request(y+"pay/"+t,{})}}]),t}(),j.User=E,j.Object=D,j.Query=x,j.Pointer=w,j.GeoPoint=k,j.Relation=S,j.File=O,j.Cloud=function(){function t(){i(this,t)}return e(t,null,[{key:"run",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.request({method:"POST",url:y+"functions/"+t,data:e})}}]),t}(),j.initialize=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";j.secretKey=t,j.apiKey=e,j.applicationId=t,j.securityCode=e,j.restKey=i,P.set("Bmob",j),setTimeout(function(){var t=new x("bmob.js");t.equalTo("name","bmob.js"),t.find().catch(function(t){console.log("Failed to fetch version info for bmob.js.")})},1e3)},j.debug=function(){j.Debug=!0},j.Request=d,j.Error=l,j.Event=h,j.Storage=T,j.Cache=v,j.options=v,j});
