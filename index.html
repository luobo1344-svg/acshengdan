<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘ç«¯é­”æ³•åœ£è¯æ ‘ (æœ€ç»ˆä¿®å¤ç‰ˆ)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: sans-serif; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 20px; box-sizing: border-box; }
        .glass-panel { pointer-events: auto; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(8px); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.2); color: white; margin-top: 50px; }
        h1 { margin: 0; font-size: 24px; color: #00ff88; text-shadow: 0 0 10px #00ff88; }
        p { margin: 10px 0 0 0; font-size: 14px; color: #ddd; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #00ff88; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid #00ff88; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>

    <!-- 1. å¼•ç”¨ Three.js (ä½¿ç”¨ cdnjs æºï¼Œæ›´ç¨³å®š) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- 2. å¼•ç”¨ OrbitControls (å¯¹åº” r128 ç‰ˆæœ¬) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.min.js"></script>
    <!-- 3. å¼•ç”¨ Bmob SDK (å¦‚æœä¸æˆåŠŸä¹Ÿä¸ä¼šå¯¼è‡´é»‘å±) -->
    <script src="https://unpkg.com/bmob-js-sdk-v4@4.0.0/dist/Bmob-4.0.0.min.js"></script>
</head>
<body>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div id="loader">
        <div class="spinner"></div>
        <div id="loader-text">æ­£åœ¨å¬å”¤åœ£è¯æ ‘...</div>
    </div>

    <!-- UI ç•Œé¢ -->
    <div id="ui-layer">
        <div class="glass-panel">
            <h1>ğŸ„ é­”æ³•åœ£è¯æ ‘</h1>
            <p id="status-msg">æ­£åœ¨åˆå§‹åŒ– 3D å¼•æ“...</p>
        </div>
    </div>

    <script>
        // --- å®¹é”™åˆå§‹åŒ– Bmob ---
        // å°±ç®— Bmob æ²¡åŠ è½½ï¼Œä¹Ÿä¸ä¼šè®©æ•´ä¸ªç¨‹åºæŠ¥é”™åœæ­¢
        const SECRET_KEY = "c9f545074cd83b7b"; 
        const API_KEY = "1343356157845614";
        
        let bmobReady = false;
        if (typeof Bmob !== 'undefined') {
            try {
                Bmob.initialize(SECRET_KEY, API_KEY);
                bmobReady = true;
                console.log("Bmob è¿æ¥æˆåŠŸ");
            } catch(e) { console.log("Bmob åˆå§‹åŒ–è­¦å‘Š", e); }
        } else {
            console.log("Bmob åº“æœªåŠ è½½ï¼Œè¿›å…¥ç¦»çº¿æ¨¡å¼");
        }

        // --- 3D åœºæ™¯é€»è¾‘ ---
        let scene, camera, renderer, controls, treeSystem;

        function init() {
            try {
                // 1. æ£€æŸ¥ Three.js æ˜¯å¦åŠ è½½
                if (typeof THREE === 'undefined') {
                    throw new Error("Three.js æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼");
                }

                // 2. åˆ›å»ºåœºæ™¯
                scene = new THREE.Scene();

                // 3. åˆ›å»ºç›¸æœº
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 15, 50);

                // 4. åˆ›å»ºæ¸²æŸ“å™¨
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                document.body.appendChild(renderer.domElement);

                // 5. æ§åˆ¶å™¨ (é˜²æ­¢æŠ¥é”™çš„å…³é”®æ£€æŸ¥)
                if (THREE.OrbitControls) {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.autoRotate = true;
                    controls.autoRotateSpeed = 2.0;
                } else {
                    console.warn("OrbitControls åŠ è½½å¤±è´¥ï¼Œé¼ æ ‡å°†æ— æ³•æ§åˆ¶æ—‹è½¬ï¼Œä½†æ ‘ä¼šæ˜¾ç¤ºã€‚");
                    document.getElementById('status-msg').innerText = "è­¦å‘Šï¼šé¼ æ ‡æ§åˆ¶ç»„ä»¶æœªåŠ è½½";
                }

                // 6. é€ æ ‘
                createTree();

                // 7. å…³é—­åŠ è½½å±‚
                document.getElementById('loader').style.display = 'none';
                document.getElementById('status-msg').innerText = bmobReady ? "ç³»ç»Ÿæ­£å¸¸ | äº‘ç«¯å·²è¿æ¥" : "ç¦»çº¿æ¨¡å¼ (ä»…æœ¬åœ°æµè§ˆ)";

                // 8. å¼€å§‹åŠ¨ç”»
                animate();

            } catch (err) {
                console.error(err);
                document.getElementById('loader-text').innerText = "å¯åŠ¨å¤±è´¥: " + err.message;
                document.getElementById('loader-text').style.color = "red";
            }
        }

        function createTree() {
            // åˆ›å»ºç²’å­æè´¨
            const geometry = new THREE.BufferGeometry();
            const count = 4000;
            const positions = [];
            const colors = [];
            
            const color1 = new THREE.Color(0x00ff88); // ç»¿è‰²
            const color2 = new THREE.Color(0xff0055); // çº¢è‰²è£…é¥°

            for (let i = 0; i < count; i++) {
                // èºæ—‹ä¸Šå‡ç®—æ³•
                const i3 = i * 3;
                const progress = i / count; // 0 åˆ° 1
                const angle = i * 0.15; // æ—‹è½¬è§’åº¦
                
                // æ ‘å† å½¢çŠ¶ï¼šä¸‹é¢å¤§ä¸Šé¢å°
                const radius = 20 * (1 - progress); 
                
                const x = Math.cos(angle) * radius;
                const y = (progress * 50) - 25; // é«˜åº¦æ‹‰ä¼¸
                const z = Math.sin(angle) * radius;

                positions.push(x, y, z);

                // éšæœºé¢œè‰²æ··å…¥
                if (Math.random() > 0.9) {
                    colors.push(color2.r, color2.g, color2.b);
                } else {
                    colors.push(color1.r, color1.g, color1.b);
                }
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({
                size: 0.6,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            treeSystem = new THREE.Points(geometry, material);
            scene.add(treeSystem);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (controls) controls.update();
            
            // è®©æ ‘è‡ªå·±å¾®å¼±æ—‹è½¬ï¼Œå¢åŠ åŠ¨æ„Ÿ
            if (treeSystem) treeSystem.rotation.y += 0.002;

            renderer.render(scene, camera);
        }

        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // å¯åŠ¨ï¼
        init();
    </script>
</body>
</html>
