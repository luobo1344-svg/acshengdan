<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘ç«¯é­”æ³•åœ£è¯æ ‘ (acåœ£è¯å¿«ä¹)</title>
    
    <!-- 1. æ ¸å¿ƒåº“å…¨éƒ¨æ”¹ä¸ºæœ¬åœ°å¼•ç”¨ -->
    <script src="./three.min.js"></script>
    <script src="./OrbitControls.js"></script>
    <script src="./EffectComposer.js"></script>
    <script src="./RenderPass.js"></script>
    <script src="./UnrealBloomPass.js"></script>
    
    <!-- 2. Bmob SDK æœ¬åœ°å¼•ç”¨ -->
    <script src="./Bmob.js"></script>

    <!-- 3. AI è¯†åˆ«åº“å·²æš‚æ—¶ç¦ç”¨ï¼Œä»¥æ’é™¤å¹²æ‰° -->

    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; box-sizing: border-box; z-index: 10;
        }
        .glass-panel {
            background: rgba(20, 20, 35, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 15px; color: white;
            pointer-events: auto; text-align: center;
        }
        h1 { margin: 0 0 5px 0; font-size: 1.5rem; color: #fff; text-shadow: 0 0 10px #00ff88; }
        p { font-size: 0.8rem; color: #ccc; margin: 0; }
        .btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        .btn {
            border: none; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; cursor: pointer; color: white; transition: 0.3s; display: flex; align-items: center; gap: 5px;
        }
        .btn-upload { background: linear-gradient(135deg, #ff0055, #ff5588); box-shadow: 0 4px 15px rgba(255,0,85,0.4); }
        .btn-upload:hover { transform: scale(1.05); }
        .btn-clear { background: rgba(255,255,255,0.1); border: 1px solid #555; font-size: 0.8rem; }
        #file-input { display: none; }
        .status-bar {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 20px; font-size: 12px; color: #00ff88;
        }
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top: 3px solid #00ff88; border-radius: 50%; animation: spin 1s infinite linear; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loader"><div class="spinner"></div><div id="loader-text">æ­£åœ¨åˆå§‹åŒ–...</div></div>
    <div id="ui-layer">
        <div class="glass-panel" style="margin: 0 auto; max-width: 400px;">
            <h1>ğŸ„ é­”æ³•äº‘ç«¯æ ‘</h1>
            <p>ç…§ç‰‡å·²äº‘ç«¯åŒæ­¥ â€¢ ä¸åŒè®¾å¤‡å¯è§</p>
            <div class="btn-group">
                <label class="btn btn-upload">ğŸ“· æ·»åŠ ç…§ç‰‡<input type="file" id="file-input" accept="image/*" multiple></label>
                <button class="btn btn-clear" onclick="clearMemories()">ğŸ—‘ï¸ æ¸…ç©ºé‡ç½®</button>
            </div>
            <p style="margin-top: 8px; font-size: 0.7rem; opacity: 0.6;">æ‰‹åŠ¿åŠŸèƒ½å·²ä¸´æ—¶ç¦ç”¨</p>
        </div>
        <div class="status-bar" id="status-text">ç³»ç»Ÿå°±ç»ª</div>
    </div>
    <script>
        // Bmob é…ç½® (è¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„!)
        const SECRET_KEY = "c9f545074cd83b7b"; 
        const API_KEY = "1343356157845614";
        
        let isOffline = false;
        try {
            Bmob.initialize(SECRET_KEY, API_KEY);
        } catch(e) {
            console.error("Bmob åˆå§‹åŒ–å¤±è´¥:", e);
            isOffline = true;
        }

        let scene, camera, renderer, composer, controls;
        let treeSystem, photoGroup;
        const isMobile = window.innerWidth < 800;

        function initScene() {
            try {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 10, 60);

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);

                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.autoRotate = true;

                createParticles();
                photoGroup = new THREE.Group();
                scene.add(photoGroup);

                document.getElementById('loader').style.display = 'none';

                animate();
            } catch (e) {
                document.getElementById('loader-text').innerText = 'é”™è¯¯: 3Då¼•æ“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ three.min.js å’Œ OrbitControls.js æ–‡ä»¶æ˜¯å¦æ­£ç¡®ã€‚';
                console.error("Three.js åˆå§‹åŒ–å¤±è´¥: ", e);
            }
        }
        
        function createParticles() {
            const geometry = new THREE.BufferGeometry();
            const count = 3000;
            const positions = new Float32Array(count * 3);
            for(let i=0; i<count; i++) {
                const p = i / count;
                const angle = i * 0.2;
                const r = 18 * (1 - p);
                positions[i*3] = Math.cos(angle) * r;
                positions[i*3+1] = p * 40 - 20;
                positions[i*3+2] = Math.sin(angle) * r;
            }
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const mat = new THREE.PointsMaterial({ color: '#00ff88', size: 0.5 });
            treeSystem = new THREE.Points(geometry, mat);
            scene.add(treeSystem);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // ç¡®ä¿æ–‡æ¡£åŠ è½½å®Œæ¯•åå†æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', (event) => {
            // è¿™æ˜¯ä¸€ä¸ªæ£€æŸ¥ï¼Œç¡®ä¿JSæ–‡ä»¶éƒ½åŠ è½½æˆåŠŸ
            if (typeof THREE === 'undefined' || typeof Bmob === 'undefined') {
                 document.getElementById('loader-text').innerText = 'é”™è¯¯: æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ã€‚è¯·æ£€æŸ¥æ‰€æœ‰æœ¬åœ°JSæ–‡ä»¶å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚';
                 console.error('THREE or Bmob is not defined!');
                 return;
            }
            initScene();
        });

        // å…¶ä»–åŠŸèƒ½æš‚æ—¶ä¿ç•™æœ€ç®€ï¼Œåç»­å†æ·»åŠ 
        window.clearMemories = () => { alert('åŠŸèƒ½å°†åœ¨ä¿®å¤åæ¢å¤'); };
        document.getElementById('file-input').addEventListener('change', () => { alert('åŠŸèƒ½å°†åœ¨ä¿®å¤åæ¢å¤'); });

    </script>
</body>
</html>
